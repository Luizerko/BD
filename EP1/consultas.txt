#4.1
SELECT FUNCAO, DESCRICAO
FROM ep1.PERFIL
INNER JOIN (SELECT CODIGO_PERFIL, DESCRICAO 
	    FROM ep1.SERVICO
	    INNER JOIN ep1.ACESSO_A
	    ON ep1.SERVICO.CODIGO=ep1.ACESSO_A.ACESSO_SERVICOS) AS AUX
ON ep1.PERFIL.CODIGO_PERFIL=AUX.CODIGO_PERFIL;

#4.2
SELECT DESCRICAO, FUNCAO, COUNT(*)
FROM ep1.PERFIL
INNER JOIN (SELECT CODIGO_SERVICO, DESCRICAO, CODIGO_PERFIL_S
	    FROM ep1.SERVICO
	    INNER JOIN (SELECT CODIGO_SERVICO, CODIGO_PERFIL_S
	    		FROM ep1.UTILIZA) AS AUX1
	    ON ep1.SERVICO.CODIGO=AUX1.CODIGO_SERVICO) AS AUX2
ON ep1.PERFIL.CODIGO_PERFIL=AUX2.CODIGO_PERFIL_S
GROUP BY DESCRICAO, FUNCAO
ORDER BY COUNT(*) ASC;

#4.3
SELECT TIPO, VIRUS, NOME, TIME_COLETA
FROM (SELECT TIPO, VIRUS, CPF_PACIENTE, TIME_COLETA
      FROM ep1.EXAME) AS AUX
INNER JOIN ep1.PACIENTE
ON AUX.CPF_PACIENTE=ep1.PACIENTE.CPF_PACIENTE;

#4.4
SELECT TIPO, VIRUS
FROM ep1.EXAME
GROUP BY TIPO, VIRUS
ORDER BY COUNT(*) DESC
LIMIT 2;
